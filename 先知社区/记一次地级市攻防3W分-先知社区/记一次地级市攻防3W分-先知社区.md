

# 记一次地级市攻防 3W 分 - 先知社区

记一次地级市攻防 3W 分

- - -

> 注：都是很基础的操作，没什么特别的手法，第一次记录，有问题可联系更改，违反规则，请联系作者马上删除，请勿转载，谢谢大家。
> 
> 大家看看就行了，也没啥特殊手法，刚毕业的脚本小子第一次打这么高分，记录一下，最后有些问题，望大佬指教，指出错误之处。

组成部分  
几家家近乎穿的单位（某传统企业，某科技企业，某国企）  
一家敏感下属单位（超大型内网（最后一天只探了个活，太累了））  
一家 40w 条某医疗单位数据泄露  
杂七杂八的弱口令，后台

后期实在是刷不动了，太累了，义务劳动，也没啥钱。

信息收集->打点->弹完整 shell（root/system）-> 上 nps/Neo-reGeorg/erfrp 代理 -> 刷内网

# 总体思路

struts\_046f --> 向日葵右键退出杀软（绕杀软） --> 机器环境有问题 --> 刷本机分

# 某医药公司

## 打点

正面突破 struts\_046f 一把梭，哥斯拉直接上线 webshell，java 的环境大家都知道一般是最高权限。

## 终端对抗 - 谢谢运维哥

-   `tasklist svc` 一瞅，我尼玛，360 和小红伞。运维哥别把，下次别装俩了，对电脑不好。

常规 cs shellcode 一扔寄，敏感操作寄，分离加载混淆寄，静态 ok，动态一动无。  
于是乎陷入沉思。。先吃个饭把，，，

后面翻着翻着文件，仔细看了进程，我擦，SunloginClient.exe 好东西，谢谢运维哥赏饭吃，直接读向日葵配置文件，连接！右键退出 360，小红伞。  
[https://github.com/wafinfo/Sunflower\_get\_Password](https://github.com/wafinfo/Sunflower_get_Password) 具体用法看 github

嘿嘿还得看我向日葵

直接上 supershell 进行后续操作

## 代理

都无杀软了，无脑 nps 带出 socks5。遇到问题了我擦，无论啥 exe 放进这破机器，显示 xxxx.dll、vs 错误，我日。原来不是我 cs 没法上线，是他不能运行。看了 2 小时无果。尝试修复，寄。

## 刷分

那咋办嘞，只能刷下本机的分喽。  
官方控制权限 xx 分  
Oracle 本机 xx 分  
sqlserver 本机 xx 分  
xx 药管理系统 xx 分  
PostgreSQL xx 分

骗分小能手 yyds

# 某敏感下属单位

## 总体思路

在野利用 exp --> 386 的机器 --> 绕 edr --> 超大型内网（未深入）

## 打点

在野利用 exp，某华的智慧 xx 管理系统

## 代理

直接上代理有些问题，由于是 386 的 linux，kscan/fscan 修改版都通过 go 编译了一份 386 的版本。平常只备了 x86\_64。

## edr

某 x 服 edr，没杀 supershell 的 go 混淆，不带 upx。上去看文件夹啥`s****for`我擦，以为要寄了，结果不干我打 supershell 那没办法了。按官网教程退出了。。密码是弱口令。。。但又好像不是，类似于 P@ssw0rd 这类，8 位，大小写，特殊字符 233。

## 内网

正常流程应该是咋样的？拿 fscan 扫 ifconfig 的 C 段？是这样么

直接 kscan --spy 干 172/192/10 的 A 段，不要怂，就是干，就 7 天能咋办，你要无感知？底线程扫几天都不够哇

一扫！172、10、192 加起来的网关存活有 83 个 C 段？？？？？最后一天了，直接放弃，摆烂。结束，随便扫点 fscan 的交一下，入口点交一下。

# 某国企

## 总体思路

在野 exp --> 双网卡主机，直接俩内网--> H3C 交换机 --> 突破隔离--> 刷内网

## 打点

冰蝎+supershell+nps

## 内网

nps 开了之后也没啥杀毒软件，直接 Proxifier 代理上了。  
密码喷洒战士，直接交换机拿下，打通 vlan。

50 多个个大华弱口令，牛 2023 居然还有不改大华密码的  
10 台 FTP  
1 台 mysql  
1 台永恒之蓝，不敢打，怕蓝屏  
某安卓设备远程控制，其实就是 adb+ 一款云端远程桌面软件。不得不说 adb root 很爽。康样子应该是个 4.4.2 的版本，而且极大可能性不是国内 ROM。更类似于 AOSP？那种

# 某医疗单位

其他市 ip，后台弱口令。。。就是医生记录用的系统。几十 w 条数据，居然不算重大成果 233

主要还是信息收集，这类 ip 无论是 hunter 还是 fofa，都是没有的，具体是拿下旁站 sql 从数据库里看到 ip，试着干一下，很容易偏。

# 小技巧

脚本小子，初级红的一些，大佬勿笑。

其实也不算技巧，打点依然是老生常谈，nday/钓鱼/1day，基本也没啥方法了，望大佬指教

在终端对抗想法，现在大伙都追求免杀，我比较菜只能上一些白名单应用，如之前的长亭某管理 vps 工具，360 云的团队管理工具，向日葵（UAC 会不行），teamview，todesk，anydesk。都是一种方法，能达到目标就行。不一定要用 CS 这种 C2 阿，当然 CS 的 dns，icmp 上线，横向操作还是很棒的，对于一些国内 c2 工具，只考虑了 http 上线。可否思考一些其他手法上线，用一些少见协议。

对于 fscan 的缺点也很明显，端口--协议，这是一种很容易错过一些点的方式。但追求速度和准确性，fscan 的快速打点也是非常不错的。在大型内网中 fscan 显然有些吃力。

webshell 一定要正常 http 么，比如某技术的 WebSocket 也可以哇，一搜结果大神们很早时间就开始搞了。

隐匿：某技术的 cdn+webstock+SSL+ 伪装流量是否也可以用于攻防，有效已经很不错了，值得一提，cf 太慢了。自选 ip 又无法有效匿，至于腾讯云函数也有了反制手段，有授权考虑国内 cdn。能不能访问也通过 cdn-->vps --> cdn 两层 cdn+ 心跳延迟 + 某代理池。可以在另一台 vps 上心跳到另一台 vps 再到 c2。心跳其实很重要。这些都是常规手段。

对于 shiro 这种需要跑 key 爆破可以信息搜集开始时一直挂后台 run。

传统 nc，powershell 弹 shell 肯定是不太好用的，考虑 supershell，vshell 这类新型工具，在某些奇葩情况下可以考虑 echo 写入文件。

内网有时候大家都是看 ifconfig，其实不然，在网络架构中通过 vlan 划分，一般情况可以看 ifconfig，但其实主机可达还是需要探测，因为咱也不知道他网关可以到哪边。

在地级市中其实 nday 可行性还是非常大的，但往上就有点吃力了。挑软柿子捏，刷分。

# 望佬解答

像一些比较难打的单位，手上也没啥 day，逻辑也没挖到可以直接 shell。除了钓鱼想不到其他的了，这时候该咋办。望佬解答

对于突破强隔离还有些不明白，目前只有遇到要么是内网中内网一台可以通其他网段，要么直接拿下交换机，把 vlan 打通。有没有啥其他方法，望佬解答。

有时候遇到准入机，双向加密机很无奈，遇到零信任没有账号很无奈。望佬解答

遇到过一台 netservice 权限的 winserver2016，没有写入权限，只读当前目录，禁用大部分命令。实在不知道咋绕了，webshell 根假的一样呜呜呜，望佬解答
